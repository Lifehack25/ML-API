name = "ml-api"
main = "src/index.ts"
compatibility_date = "2024-10-01"
workers_dev = true

[vars]
APPLE_BUNDLE_ID = "com.memorylocks.mlmobileapp"

[[d1_databases]]
binding = "DB"
database_id = "3afe1cf6-4d2c-4461-9b41-1c8e232e8361"

# Durable Objects for distributed rate limiting
[[durable_objects.bindings]]
name = "RATE_LIMITER"
class_name = "RateLimiter"
script_name = "ml-api"

[[migrations]]
tag = "v1"
new_sqlite_classes = ["RateLimiter"]

# Cron triggers for background jobs
[triggers]
crons = [
  "0 2 * * *",      # Daily at 2 AM UTC: cleanup expired idempotency keys
  "*/15 * * * *"    # Every 15 minutes: process Cloudflare cleanup jobs
]
